import{_ as n,e as a,g as l,o}from"./app-BcLUFOMF.js";const p={};function e(t,s){return o(),a("div",null,s[0]||(s[0]=[l(`<p>在 .NET 中，Options 是一套 用于绑定和管理配置的推荐做法，比直接使用 IConfiguration 更加强类型、安全、可维护。</p><ul><li><p>把配置项绑定到强类型对象（类似 <code>Get&lt;AppSettings&gt;()</code>）</p></li><li><p>支持依赖注入（通过 <code>IOptions&lt;T&gt;</code>注入配置）</p></li><li><p>支持配置验证、热更新（reload on change）等高级功能</p></li><li><p>让配置逻辑和业务逻辑分离，提高代码可读性和可测试性</p></li></ul><h2 id="使用" tabindex="-1"><a class="header-anchor" href="#使用"><span>使用</span></a></h2><p><code>appsettings.json</code></p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="background-color:#282A36;color:#F8F8F2;"><pre class="shiki dracula vp-code"><code><span class="line"><span style="color:#F8F8F2;">{</span></span>
<span class="line"><span style="color:#8BE9FE;">  &quot;</span><span style="color:#8BE9FD;">MySettings</span><span style="color:#8BE9FE;">&quot;</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#8BE9FE;">    &quot;</span><span style="color:#8BE9FD;">Title</span><span style="color:#8BE9FE;">&quot;</span><span style="color:#FF79C6;">:</span><span style="color:#E9F284;"> &quot;</span><span style="color:#F1FA8C;">Options Demo</span><span style="color:#E9F284;">&quot;</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#8BE9FE;">    &quot;</span><span style="color:#8BE9FD;">MaxUsers</span><span style="color:#8BE9FE;">&quot;</span><span style="color:#FF79C6;">:</span><span style="color:#BD93F9;"> 50</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>配置options服务</p><div class="language-csharp line-numbers-mode" data-highlighter="shiki" data-ext="csharp" data-title="csharp" style="background-color:#282A36;color:#F8F8F2;"><pre class="shiki dracula vp-code"><code><span class="line"><span style="color:#FF79C6;">public</span><span style="color:#FF79C6;"> class</span><span style="color:#8BE9FD;"> MySettings</span></span>
<span class="line"><span style="color:#F8F8F2;">{</span></span>
<span class="line"><span style="color:#FF79C6;">    public</span><span style="color:#FF79C6;"> string</span><span style="color:#F8F8F2;"> Title { </span><span style="color:#FF79C6;">get</span><span style="color:#F8F8F2;">; </span><span style="color:#FF79C6;">set</span><span style="color:#F8F8F2;">; }</span></span>
<span class="line"><span style="color:#FF79C6;">    public</span><span style="color:#FF79C6;"> int</span><span style="color:#F8F8F2;"> MaxUsers { </span><span style="color:#FF79C6;">get</span><span style="color:#F8F8F2;">; </span><span style="color:#FF79C6;">set</span><span style="color:#F8F8F2;">; }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"><span style="color:#F8F8F2;">builder.Services.</span><span style="color:#50FA7B;">Configure</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#8BE9FD;font-style:italic;">MySettings</span><span style="color:#F8F8F2;">&gt;(</span></span>
<span class="line"><span style="color:#F8F8F2;">    builder.Configuration.</span><span style="color:#50FA7B;">GetSection</span><span style="color:#F8F8F2;">(</span><span style="color:#E9F284;">&quot;</span><span style="color:#F1FA8C;">MySettings</span><span style="color:#E9F284;">&quot;</span><span style="color:#F8F8F2;">));</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>使用</p><div class="language-csharp line-numbers-mode" data-highlighter="shiki" data-ext="csharp" data-title="csharp" style="background-color:#282A36;color:#F8F8F2;"><pre class="shiki dracula vp-code"><code><span class="line"><span style="color:#FF79C6;">public</span><span style="color:#FF79C6;"> class</span><span style="color:#8BE9FD;"> MyService</span></span>
<span class="line"><span style="color:#F8F8F2;">{</span></span>
<span class="line"><span style="color:#FF79C6;">    private</span><span style="color:#FF79C6;"> readonly</span><span style="color:#8BE9FD;font-style:italic;"> MySettings</span><span style="color:#F8F8F2;"> _settings;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6;">    public</span><span style="color:#50FA7B;"> MyService</span><span style="color:#F8F8F2;">(</span><span style="color:#8BE9FD;font-style:italic;">IOptions</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#8BE9FD;font-style:italic;">MySettings</span><span style="color:#F8F8F2;">&gt; </span><span style="color:#FFB86C;font-style:italic;">options</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">    {</span></span>
<span class="line"><span style="color:#F8F8F2;">        _settings </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> options.Value;</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6;">    public</span><span style="color:#FF79C6;"> void</span><span style="color:#50FA7B;"> PrintSettings</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">    {</span></span>
<span class="line"><span style="color:#F8F8F2;">        Console.</span><span style="color:#50FA7B;">WriteLine</span><span style="color:#F8F8F2;">(</span><span style="color:#E9F284;">$&quot;</span><span style="color:#F1FA8C;">Title: </span><span style="color:#FF79C6;">{</span><span style="color:#F8F8F2;">_settings</span><span style="color:#F1FA8C;">.</span><span style="color:#F8F8F2;">Title</span><span style="color:#FF79C6;">}</span><span style="color:#F1FA8C;">, MaxUsers: </span><span style="color:#FF79C6;">{</span><span style="color:#F8F8F2;">_settings</span><span style="color:#F1FA8C;">.</span><span style="color:#F8F8F2;">MaxUsers</span><span style="color:#FF79C6;">}</span><span style="color:#E9F284;">&quot;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="options读取" tabindex="-1"><a class="header-anchor" href="#options读取"><span>Options读取</span></a></h2><table><thead><tr><th>接口名</th><th>生命周期</th><th>是否支持热更新</th><th>使用场景</th></tr></thead><tbody><tr><td><code>IOptions&lt;T&gt;</code></td><td>单例（Singleton）</td><td>❌ 否</td><td>默认选项，适合配置不变的场景</td></tr><tr><td><code>IOptionsSnapshot&lt;T&gt;</code></td><td>每请求一次（Scoped）</td><td>✅ 是</td><td>Web 应用中，每次请求获取新配置</td></tr><tr><td><code>IOptionsMonitor&lt;T&gt;</code></td><td>单例（Singleton）</td><td>✅ 是</td><td>长时间运行的服务，动态监听配置变更</td></tr><tr><td><code>IOptionsFactory&lt;T&gt;</code></td><td>用于内部创建配置实例</td><td>✅ 取决于配置源</td><td>自定义配置构造逻辑时使用，不常直接注入</td></tr></tbody></table><ul><li><p>✅ 配置不需要变更：用 <code>IOptions&lt;T&gt;</code></p></li><li><p>🔁 配置需要每请求更新：用 <code>IOptionsSnapshot&lt;T&gt;</code></p></li><li><p>🔄 配置需要动态热更新或监听变化：用 <code>IOptionsMonitor&lt;T&gt;</code></p></li><li><p>🏗️ 需要控制配置创建逻辑（很少用）：用 <code>IOptionsFactory&lt;T&gt;</code></p></li></ul><h3 id="ioptions" tabindex="-1"><a class="header-anchor" href="#ioptions"><span>IOptions</span></a></h3><ul><li>该接口对象实例生命周期为 Singleton，因此能够将该接口注入到任何生命周期的服务中</li><li>当该接口被实例化后，其中的选项值将永远保持不变，即使后续修改了与选项进行绑定的配置，也永远读取不到修改后的配置值</li><li>不支持命名选项（Named Options</li></ul><div class="language-csharp line-numbers-mode" data-highlighter="shiki" data-ext="csharp" data-title="csharp" style="background-color:#282A36;color:#F8F8F2;"><pre class="shiki dracula vp-code"><code><span class="line"><span style="color:#FF79C6;">public</span><span style="color:#FF79C6;"> class</span><span style="color:#8BE9FD;"> ValuesController</span><span style="color:#F8F8F2;"> : </span><span style="color:#8BE9FD;font-style:italic;">ControllerBase</span></span>
<span class="line"><span style="color:#F8F8F2;">{</span></span>
<span class="line"><span style="color:#FF79C6;">    private</span><span style="color:#FF79C6;"> readonly</span><span style="color:#8BE9FD;font-style:italic;"> BookOptions</span><span style="color:#F8F8F2;"> _bookOptions;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6;">    public</span><span style="color:#50FA7B;"> ValuesController</span><span style="color:#F8F8F2;">(</span><span style="color:#8BE9FD;font-style:italic;">IOptions</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#8BE9FD;font-style:italic;">BookOptions</span><span style="color:#F8F8F2;">&gt; </span><span style="color:#FFB86C;font-style:italic;">bookOptions</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">    {</span></span>
<span class="line"><span style="color:#6272A4;">        // bookOptions.Value 始终是程序启动时加载的配置，永远不会改变</span></span>
<span class="line"><span style="color:#F8F8F2;">        _bookOptions </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> bookOptions.Value;</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ioptionssnapshot" tabindex="-1"><a class="header-anchor" href="#ioptionssnapshot"><span>IOptionsSnapshot</span></a></h3><p>该接口被注册为 Scoped，因此该接口无法注入到 Singleton 的服务中，只能注入到 Transient 和 Scoped 的服务中。 在作用域中，创建<code>IOptionsSnapshot&lt;TOptions&gt;</code>对象实例时，会从配置中读取最新选项值作为快照，并在作用域中始终使用该快照。 支持命名选项</p><div class="language-csharp line-numbers-mode" data-highlighter="shiki" data-ext="csharp" data-title="csharp" style="background-color:#282A36;color:#F8F8F2;"><pre class="shiki dracula vp-code"><code><span class="line"><span style="color:#FF79C6;">public</span><span style="color:#FF79C6;"> class</span><span style="color:#8BE9FD;"> ValuesController</span><span style="color:#F8F8F2;"> : </span><span style="color:#8BE9FD;font-style:italic;">ControllerBase</span></span>
<span class="line"><span style="color:#F8F8F2;">{</span></span>
<span class="line"><span style="color:#FF79C6;">    private</span><span style="color:#FF79C6;"> readonly</span><span style="color:#8BE9FD;font-style:italic;"> BookOptions</span><span style="color:#F8F8F2;"> _bookOptions;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6;">    public</span><span style="color:#50FA7B;"> ValuesController</span><span style="color:#F8F8F2;">(</span><span style="color:#8BE9FD;font-style:italic;">IOptionsSnapshot</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#8BE9FD;font-style:italic;">BookOptions</span><span style="color:#F8F8F2;">&gt; </span><span style="color:#FFB86C;font-style:italic;">bookOptionsSnapshot</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">    {</span></span>
<span class="line"><span style="color:#6272A4;">        // bookOptions.Value 是 Options 对象实例创建时读取的配置快照</span></span>
<span class="line"><span style="color:#F8F8F2;">        _bookOptions </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> bookOptionsSnapshot.Value;</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ioptionsmonitor" tabindex="-1"><a class="header-anchor" href="#ioptionsmonitor"><span>IOptionsMonitor</span></a></h3><ul><li>该接口除了可以查看TOptions的值，还可以监控TOptions配置的更改。</li><li>该接口被注册为 Singleton，因此能够将该接口注入到任何生命周期的服务中</li><li>每次读取选项值时，都是从配置中读取最新选项值（具体读取逻辑查看下方三种接口对比测试）。</li><li>支持： <ul><li>命名选项</li><li>重新加载配置（<code>CurrentValue</code>），并当配置发生更改时，进行通知（<code>OnChange</code>）</li><li>缓存与缓存失效 (<code>IOptionsMonitorCache&lt;TOptions&gt;</code>)</li></ul></li></ul><div class="language-csharp line-numbers-mode" data-highlighter="shiki" data-ext="csharp" data-title="csharp" style="background-color:#282A36;color:#F8F8F2;"><pre class="shiki dracula vp-code"><code><span class="line"><span style="color:#FF79C6;">public</span><span style="color:#FF79C6;"> class</span><span style="color:#8BE9FD;"> ValuesController</span><span style="color:#F8F8F2;"> : </span><span style="color:#8BE9FD;font-style:italic;">ControllerBase</span></span>
<span class="line"><span style="color:#F8F8F2;">{</span></span>
<span class="line"><span style="color:#FF79C6;">    private</span><span style="color:#FF79C6;"> readonly</span><span style="color:#8BE9FD;font-style:italic;"> IOptionsMonitor</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#8BE9FD;font-style:italic;">BookOptions</span><span style="color:#F8F8F2;">&gt; _bookOptionsMonitor;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6;">    public</span><span style="color:#50FA7B;"> ValuesController</span><span style="color:#F8F8F2;">(</span><span style="color:#8BE9FD;font-style:italic;">IOptionsMonitor</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#8BE9FD;font-style:italic;">BookOptions</span><span style="color:#F8F8F2;">&gt; </span><span style="color:#FFB86C;font-style:italic;">bookOptionsMonitor</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">    {</span></span>
<span class="line"><span style="color:#6272A4;">        // _bookOptionsMonitor.CurrentValue 的值始终是最新配置的值</span></span>
<span class="line"><span style="color:#F8F8F2;">        _bookOptionsMonitor </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> bookOptionsMonitor;</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="命名选项" tabindex="-1"><a class="header-anchor" href="#命名选项"><span>命名选项</span></a></h2><p>命名选项允许我们为同一个配置项定义多个不同的选项对象，每个选项对象都有唯一的名称，通过名称来区分不同的选项对象。</p><div class="language-csharp line-numbers-mode" data-highlighter="shiki" data-ext="csharp" data-title="csharp" style="background-color:#282A36;color:#F8F8F2;"><pre class="shiki dracula vp-code"><code><span class="line"><span style="color:#6272A4;">// json</span></span>
<span class="line"><span style="color:#F8F8F2;">{</span></span>
<span class="line"><span style="color:#E9F284;">  &quot;</span><span style="color:#F1FA8C;">MvcOptions</span><span style="color:#E9F284;">&quot;</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#E9F284;">    &quot;</span><span style="color:#F1FA8C;">Url</span><span style="color:#E9F284;">&quot;</span><span style="color:#FF79C6;">:</span><span style="color:#E9F284;"> &quot;</span><span style="color:#F1FA8C;">123</span><span style="color:#E9F284;">&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">  },</span></span>
<span class="line"><span style="color:#E9F284;">  &quot;</span><span style="color:#F1FA8C;">WebOptions</span><span style="color:#E9F284;">&quot;</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#E9F284;">    &quot;</span><span style="color:#F1FA8C;">Url</span><span style="color:#E9F284;">&quot;</span><span style="color:#FF79C6;">:</span><span style="color:#BD93F9;"> 456</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"><span style="color:#FF79C6;">public</span><span style="color:#FF79C6;"> class</span><span style="color:#8BE9FD;"> MvcOptions</span></span>
<span class="line"><span style="color:#F8F8F2;">{</span></span>
<span class="line"><span style="color:#FF79C6;">    public</span><span style="color:#FF79C6;"> string</span><span style="color:#F8F8F2;">? Url { </span><span style="color:#FF79C6;">get</span><span style="color:#F8F8F2;">; </span><span style="color:#FF79C6;">set</span><span style="color:#F8F8F2;">; }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"><span style="color:#6272A4;">//  配置URL</span></span>
<span class="line"><span style="color:#FF79C6;">static</span><span style="color:#FF79C6;"> void</span><span style="color:#50FA7B;"> TestNamed</span><span style="color:#F8F8F2;">()</span></span>
<span class="line"><span style="color:#F8F8F2;">{</span></span>
<span class="line"><span style="color:#FF79C6;">    var</span><span style="color:#F8F8F2;"> services </span><span style="color:#FF79C6;">=</span><span style="color:#FF79C6;"> new</span><span style="color:#8BE9FD;font-style:italic;"> ServiceCollection</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"><span style="color:#FF79C6;">    var</span><span style="color:#F8F8F2;"> configuration </span><span style="color:#FF79C6;">=</span><span style="color:#50FA7B;"> GetConfiguration</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#6272A4;">    //name=Options.DefaultName</span></span>
<span class="line"><span style="color:#F8F8F2;">    services.</span><span style="color:#50FA7B;">Configure</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#8BE9FD;font-style:italic;">MvcOptions</span><span style="color:#F8F8F2;">&gt;(configuration.</span><span style="color:#50FA7B;">GetSection</span><span style="color:#F8F8F2;">(</span><span style="color:#E9F284;">&quot;</span><span style="color:#F1FA8C;">MvcOptions</span><span style="color:#E9F284;">&quot;</span><span style="color:#F8F8F2;">));</span></span>
<span class="line"><span style="color:#6272A4;">    //name=&quot;o1&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">    services.</span><span style="color:#50FA7B;">Configure</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#8BE9FD;font-style:italic;">MvcOptions</span><span style="color:#F8F8F2;">&gt;(</span><span style="color:#E9F284;">&quot;</span><span style="color:#F1FA8C;">o1</span><span style="color:#E9F284;">&quot;</span><span style="color:#F8F8F2;">, configuration.</span><span style="color:#50FA7B;">GetSection</span><span style="color:#F8F8F2;">(</span><span style="color:#E9F284;">&quot;</span><span style="color:#F1FA8C;">MvcOptions</span><span style="color:#E9F284;">&quot;</span><span style="color:#F8F8F2;">));</span></span>
<span class="line"><span style="color:#6272A4;">    //name=&quot;o2&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">    services.</span><span style="color:#50FA7B;">Configure</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#8BE9FD;font-style:italic;">MvcOptions</span><span style="color:#F8F8F2;">&gt;(</span><span style="color:#E9F284;">&quot;</span><span style="color:#F1FA8C;">o2</span><span style="color:#E9F284;">&quot;</span><span style="color:#F8F8F2;">, configuration.</span><span style="color:#50FA7B;">GetSection</span><span style="color:#F8F8F2;">(</span><span style="color:#E9F284;">&quot;</span><span style="color:#F1FA8C;">WebOptions</span><span style="color:#E9F284;">&quot;</span><span style="color:#F8F8F2;">));</span></span>
<span class="line"></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6;">    var</span><span style="color:#F8F8F2;"> container </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> services.</span><span style="color:#50FA7B;">BuildServiceProvider</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"><span style="color:#FF79C6;">    var</span><span style="color:#F8F8F2;"> o1 </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> container.</span><span style="color:#50FA7B;">GetRequiredService</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#8BE9FD;font-style:italic;">IOptionsSnapshot</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#8BE9FD;font-style:italic;">MvcOptions</span><span style="color:#F8F8F2;">&gt;&gt;();</span></span>
<span class="line"><span style="color:#FF79C6;">    var</span><span style="color:#F8F8F2;"> o2 </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> container.</span><span style="color:#50FA7B;">GetRequiredService</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#8BE9FD;font-style:italic;">IOptionsMonitor</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#8BE9FD;font-style:italic;">MvcOptions</span><span style="color:#F8F8F2;">&gt;&gt;();</span></span>
<span class="line"><span style="color:#6272A4;">    //name=&quot;o1&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">    Console.</span><span style="color:#50FA7B;">WriteLine</span><span style="color:#F8F8F2;">(</span><span style="color:#E9F284;">&quot;</span><span style="color:#F1FA8C;">IOptionsSnapshot:Named:</span><span style="color:#E9F284;">&quot;</span><span style="color:#FF79C6;"> +</span><span style="color:#F8F8F2;"> o1.</span><span style="color:#50FA7B;">Get</span><span style="color:#F8F8F2;">(</span><span style="color:#E9F284;">&quot;</span><span style="color:#F1FA8C;">o1</span><span style="color:#E9F284;">&quot;</span><span style="color:#F8F8F2;">).Url);</span></span>
<span class="line"><span style="color:#6272A4;">    //name=Options.DefaultName</span></span>
<span class="line"><span style="color:#F8F8F2;">    Console.</span><span style="color:#50FA7B;">WriteLine</span><span style="color:#F8F8F2;">(</span><span style="color:#E9F284;">&quot;</span><span style="color:#F1FA8C;">IOptionsSnapshot:Value:</span><span style="color:#E9F284;">&quot;</span><span style="color:#FF79C6;"> +</span><span style="color:#F8F8F2;"> o1.Value.Url);</span></span>
<span class="line"><span style="color:#6272A4;">    //name=&quot;o2&quot;</span></span>
<span class="line"><span style="color:#F8F8F2;">    Console.</span><span style="color:#50FA7B;">WriteLine</span><span style="color:#F8F8F2;">(</span><span style="color:#E9F284;">&quot;</span><span style="color:#F1FA8C;">IOptionsMonitor:Named:</span><span style="color:#E9F284;">&quot;</span><span style="color:#FF79C6;"> +</span><span style="color:#F8F8F2;"> o2.</span><span style="color:#50FA7B;">Get</span><span style="color:#F8F8F2;">(</span><span style="color:#E9F284;">&quot;</span><span style="color:#F1FA8C;">o2</span><span style="color:#E9F284;">&quot;</span><span style="color:#F8F8F2;">).Url);</span></span>
<span class="line"><span style="color:#6272A4;">    //name=Options.DefaultName</span></span>
<span class="line"><span style="color:#F8F8F2;">    Console.</span><span style="color:#50FA7B;">WriteLine</span><span style="color:#F8F8F2;">(</span><span style="color:#E9F284;">&quot;</span><span style="color:#F1FA8C;">IOptionsMonitor:Value:</span><span style="color:#E9F284;">&quot;</span><span style="color:#FF79C6;"> +</span><span style="color:#F8F8F2;"> o2.CurrentValue.Url);</span></span>
<span class="line"><span style="color:#FF79C6;">    var</span><span style="color:#F8F8F2;"> optionsFactory </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> sp.</span><span style="color:#50FA7B;">GetRequiredService</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#8BE9FD;font-style:italic;">IOptionsFactory</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#8BE9FD;font-style:italic;">MvcOptions</span><span style="color:#F8F8F2;">&gt;&gt;();</span></span>
<span class="line"><span style="color:#FF79C6;">    var</span><span style="color:#F8F8F2;"> options </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> optionsFactory.</span><span style="color:#50FA7B;">Create</span><span style="color:#F8F8F2;">(Options.DefaultName);</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>多个配置节点绑定同一属性</p><div class="language-json line-numbers-mode" data-highlighter="shiki" data-ext="json" data-title="json" style="background-color:#282A36;color:#F8F8F2;"><pre class="shiki dracula vp-code"><code><span class="line"><span style="color:#F8F8F2;">{</span></span>
<span class="line"><span style="color:#8BE9FE;">  &quot;</span><span style="color:#8BE9FD;">DateTime</span><span style="color:#8BE9FE;">&quot;</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#8BE9FE;">    &quot;</span><span style="color:#8BE9FD;">Beijing</span><span style="color:#8BE9FE;">&quot;</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#8BE9FE;">      &quot;</span><span style="color:#8BE9FD;">Year</span><span style="color:#8BE9FE;">&quot;</span><span style="color:#FF79C6;">:</span><span style="color:#BD93F9;"> 2021</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#8BE9FE;">      &quot;</span><span style="color:#8BE9FD;">Month</span><span style="color:#8BE9FE;">&quot;</span><span style="color:#FF79C6;">:</span><span style="color:#BD93F9;"> 1</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#8BE9FE;">      &quot;</span><span style="color:#8BE9FD;">Day</span><span style="color:#8BE9FE;">&quot;</span><span style="color:#FF79C6;">:</span><span style="color:#BD93F9;">1</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#8BE9FE;">      &quot;</span><span style="color:#8BE9FD;">Hour</span><span style="color:#8BE9FE;">&quot;</span><span style="color:#FF79C6;">:</span><span style="color:#BD93F9;">12</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#8BE9FE;">      &quot;</span><span style="color:#8BE9FD;">Minute</span><span style="color:#8BE9FE;">&quot;</span><span style="color:#FF79C6;">:</span><span style="color:#BD93F9;">0</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#8BE9FE;">      &quot;</span><span style="color:#8BE9FD;">Second</span><span style="color:#8BE9FE;">&quot;</span><span style="color:#FF79C6;">:</span><span style="color:#BD93F9;">0</span></span>
<span class="line"><span style="color:#F8F8F2;">    },</span></span>
<span class="line"><span style="color:#8BE9FE;">    &quot;</span><span style="color:#8BE9FD;">Tokyo</span><span style="color:#8BE9FE;">&quot;</span><span style="color:#FF79C6;">:</span><span style="color:#F8F8F2;"> {</span></span>
<span class="line"><span style="color:#8BE9FE;">      &quot;</span><span style="color:#8BE9FD;">Year</span><span style="color:#8BE9FE;">&quot;</span><span style="color:#FF79C6;">:</span><span style="color:#BD93F9;"> 2021</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#8BE9FE;">      &quot;</span><span style="color:#8BE9FD;">Month</span><span style="color:#8BE9FE;">&quot;</span><span style="color:#FF79C6;">:</span><span style="color:#BD93F9;"> 1</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#8BE9FE;">      &quot;</span><span style="color:#8BE9FD;">Day</span><span style="color:#8BE9FE;">&quot;</span><span style="color:#FF79C6;">:</span><span style="color:#BD93F9;">1</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#8BE9FE;">      &quot;</span><span style="color:#8BE9FD;">Hour</span><span style="color:#8BE9FE;">&quot;</span><span style="color:#FF79C6;">:</span><span style="color:#BD93F9;">13</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#8BE9FE;">      &quot;</span><span style="color:#8BE9FD;">Minute</span><span style="color:#8BE9FE;">&quot;</span><span style="color:#FF79C6;">:</span><span style="color:#BD93F9;">0</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#8BE9FE;">      &quot;</span><span style="color:#8BE9FD;">Second</span><span style="color:#8BE9FE;">&quot;</span><span style="color:#FF79C6;">:</span><span style="color:#BD93F9;">0</span></span>
<span class="line"><span style="color:#F8F8F2;">    },</span></span>
<span class="line"><span style="color:#F8F8F2;">  }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>配置</p><div class="language-csharp line-numbers-mode" data-highlighter="shiki" data-ext="csharp" data-title="csharp" style="background-color:#282A36;color:#F8F8F2;"><pre class="shiki dracula vp-code"><code><span class="line"><span style="color:#FF79C6;">public</span><span style="color:#FF79C6;"> class</span><span style="color:#8BE9FD;"> DateTimeOptions</span></span>
<span class="line"><span style="color:#F8F8F2;">{</span></span>
<span class="line"><span style="color:#FF79C6;">    public</span><span style="color:#FF79C6;"> const</span><span style="color:#FF79C6;"> string</span><span style="color:#F8F8F2;"> Beijing </span><span style="color:#FF79C6;">=</span><span style="color:#E9F284;"> &quot;</span><span style="color:#F1FA8C;">Beijing</span><span style="color:#E9F284;">&quot;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#FF79C6;">    public</span><span style="color:#FF79C6;"> const</span><span style="color:#FF79C6;"> string</span><span style="color:#F8F8F2;"> Tokyo </span><span style="color:#FF79C6;">=</span><span style="color:#E9F284;"> &quot;</span><span style="color:#F1FA8C;">Tokyo</span><span style="color:#E9F284;">&quot;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6;">    public</span><span style="color:#FF79C6;"> int</span><span style="color:#F8F8F2;"> Year { </span><span style="color:#FF79C6;">get</span><span style="color:#F8F8F2;">; </span><span style="color:#FF79C6;">set</span><span style="color:#F8F8F2;">; }</span></span>
<span class="line"><span style="color:#FF79C6;">    public</span><span style="color:#FF79C6;"> int</span><span style="color:#F8F8F2;"> Month { </span><span style="color:#FF79C6;">get</span><span style="color:#F8F8F2;">; </span><span style="color:#FF79C6;">set</span><span style="color:#F8F8F2;">; }</span></span>
<span class="line"><span style="color:#FF79C6;">    public</span><span style="color:#FF79C6;"> int</span><span style="color:#F8F8F2;"> Day { </span><span style="color:#FF79C6;">get</span><span style="color:#F8F8F2;">; </span><span style="color:#FF79C6;">set</span><span style="color:#F8F8F2;">; }</span></span>
<span class="line"><span style="color:#FF79C6;">    public</span><span style="color:#FF79C6;"> int</span><span style="color:#F8F8F2;"> Hour { </span><span style="color:#FF79C6;">get</span><span style="color:#F8F8F2;">; </span><span style="color:#FF79C6;">set</span><span style="color:#F8F8F2;">; }</span></span>
<span class="line"><span style="color:#FF79C6;">    public</span><span style="color:#FF79C6;"> int</span><span style="color:#F8F8F2;"> Minute { </span><span style="color:#FF79C6;">get</span><span style="color:#F8F8F2;">; </span><span style="color:#FF79C6;">set</span><span style="color:#F8F8F2;">; }</span></span>
<span class="line"><span style="color:#FF79C6;">    public</span><span style="color:#FF79C6;"> int</span><span style="color:#F8F8F2;"> Second { </span><span style="color:#FF79C6;">get</span><span style="color:#F8F8F2;">; </span><span style="color:#FF79C6;">set</span><span style="color:#F8F8F2;">; }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"><span style="color:#FF79C6;">public</span><span style="color:#FF79C6;"> class</span><span style="color:#8BE9FD;"> Startup</span></span>
<span class="line"><span style="color:#F8F8F2;">{</span></span>
<span class="line"><span style="color:#FF79C6;">    public</span><span style="color:#50FA7B;"> Startup</span><span style="color:#F8F8F2;">(</span><span style="color:#8BE9FD;font-style:italic;">IConfiguration</span><span style="color:#FFB86C;font-style:italic;"> configuration</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">    {</span></span>
<span class="line"><span style="color:#F8F8F2;">        Configuration </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> configuration;</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6;">    public</span><span style="color:#8BE9FD;font-style:italic;"> IConfiguration</span><span style="color:#F8F8F2;"> Configuration { </span><span style="color:#FF79C6;">get</span><span style="color:#F8F8F2;">; }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6;">    public</span><span style="color:#FF79C6;"> void</span><span style="color:#50FA7B;"> ConfigureServices</span><span style="color:#F8F8F2;">(</span><span style="color:#8BE9FD;font-style:italic;">IServiceCollection</span><span style="color:#FFB86C;font-style:italic;"> services</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">    {</span></span>
<span class="line"><span style="color:#F8F8F2;">        services.</span><span style="color:#50FA7B;">Configure</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#8BE9FD;font-style:italic;">BookOptions</span><span style="color:#F8F8F2;">&gt;(Configuration.</span><span style="color:#50FA7B;">GetSection</span><span style="color:#F8F8F2;">(BookOptions.Book));</span></span>
<span class="line"><span style="color:#F8F8F2;">        services.</span><span style="color:#50FA7B;">Configure</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#8BE9FD;font-style:italic;">DateTimeOptions</span><span style="color:#F8F8F2;">&gt;(DateTimeOptions.Beijing, Configuration.</span><span style="color:#50FA7B;">GetSection</span><span style="color:#F8F8F2;">(</span><span style="color:#E9F284;">$&quot;</span><span style="color:#F1FA8C;">DateTime:</span><span style="color:#FF79C6;">{</span><span style="color:#F8F8F2;">DateTimeOptions</span><span style="color:#F1FA8C;">.</span><span style="color:#F8F8F2;">Beijing</span><span style="color:#FF79C6;">}</span><span style="color:#E9F284;">&quot;</span><span style="color:#F8F8F2;">));</span></span>
<span class="line"><span style="color:#F8F8F2;">        services.</span><span style="color:#50FA7B;">Configure</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#8BE9FD;font-style:italic;">DateTimeOptions</span><span style="color:#F8F8F2;">&gt;(DateTimeOptions.Tokyo, Configuration.</span><span style="color:#50FA7B;">GetSection</span><span style="color:#F8F8F2;">(</span><span style="color:#E9F284;">$&quot;</span><span style="color:#F1FA8C;">DateTime:</span><span style="color:#FF79C6;">{</span><span style="color:#F8F8F2;">DateTimeOptions</span><span style="color:#F1FA8C;">.</span><span style="color:#F8F8F2;">Tokyo</span><span style="color:#FF79C6;">}</span><span style="color:#E9F284;">&quot;</span><span style="color:#F8F8F2;">));</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6;">public</span><span style="color:#FF79C6;"> class</span><span style="color:#8BE9FD;"> ValuesController</span><span style="color:#F8F8F2;"> : </span><span style="color:#8BE9FD;font-style:italic;">ControllerBase</span></span>
<span class="line"><span style="color:#F8F8F2;">{</span></span>
<span class="line"><span style="color:#FF79C6;">    private</span><span style="color:#FF79C6;"> readonly</span><span style="color:#8BE9FD;font-style:italic;"> DateTimeOptions</span><span style="color:#F8F8F2;"> _beijingDateTimeOptions;</span></span>
<span class="line"><span style="color:#FF79C6;">    private</span><span style="color:#FF79C6;"> readonly</span><span style="color:#8BE9FD;font-style:italic;"> DateTimeOptions</span><span style="color:#F8F8F2;"> _tockyoDateTimeOptions;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6;">    public</span><span style="color:#50FA7B;"> ValuesController</span><span style="color:#F8F8F2;">(</span><span style="color:#8BE9FD;font-style:italic;">IOptionsSnapshot</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#8BE9FD;font-style:italic;">DateTimeOptions</span><span style="color:#F8F8F2;">&gt; </span><span style="color:#FFB86C;font-style:italic;">dateTimeOptions</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">    {</span></span>
<span class="line"><span style="color:#F8F8F2;">        _beijingDateTimeOptions </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> dateTimeOptions.</span><span style="color:#50FA7B;">Get</span><span style="color:#F8F8F2;">(DateTimeOptions.Beijing);</span></span>
<span class="line"><span style="color:#F8F8F2;">        _tockyoDateTimeOptions </span><span style="color:#FF79C6;">=</span><span style="color:#F8F8F2;"> dateTimeOptions.</span><span style="color:#50FA7B;">Get</span><span style="color:#F8F8F2;">(DateTimeOptions.Tokyo);</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="options验证" tabindex="-1"><a class="header-anchor" href="#options验证"><span>Options验证</span></a></h2><h3 id="dataannotations" tabindex="-1"><a class="header-anchor" href="#dataannotations"><span>DataAnnotations</span></a></h3><div class="language-shell line-numbers-mode" data-highlighter="shiki" data-ext="shell" data-title="shell" style="background-color:#282A36;color:#F8F8F2;"><pre class="shiki dracula vp-code"><code><span class="line"><span style="color:#50FA7B;">Install-Package</span><span style="color:#F1FA8C;"> Microsoft.Extensions.Options.DataAnnotations</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div></div></div><div class="language-csharp line-numbers-mode" data-highlighter="shiki" data-ext="csharp" data-title="csharp" style="background-color:#282A36;color:#F8F8F2;"><pre class="shiki dracula vp-code"><code><span class="line"></span>
<span class="line"><span style="color:#FF79C6;">public</span><span style="color:#FF79C6;"> class</span><span style="color:#8BE9FD;"> BookOptions</span></span>
<span class="line"><span style="color:#F8F8F2;">{</span></span>
<span class="line"><span style="color:#FF79C6;">    public</span><span style="color:#FF79C6;"> const</span><span style="color:#FF79C6;"> string</span><span style="color:#F8F8F2;"> Book </span><span style="color:#FF79C6;">=</span><span style="color:#E9F284;"> &quot;</span><span style="color:#F1FA8C;">Book</span><span style="color:#E9F284;">&quot;</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">    [</span><span style="color:#8BE9FD;font-style:italic;">Range</span><span style="color:#F8F8F2;">(</span><span style="color:#BD93F9;">1</span><span style="color:#F8F8F2;">,</span><span style="color:#BD93F9;">1000</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">        ErrorMessage </span><span style="color:#FF79C6;">=</span><span style="color:#E9F284;"> &quot;</span><span style="color:#F1FA8C;">必须 {1} &lt;= {0} &lt;= {2}</span><span style="color:#E9F284;">&quot;</span><span style="color:#F8F8F2;">)]</span></span>
<span class="line"><span style="color:#FF79C6;">    public</span><span style="color:#FF79C6;"> int</span><span style="color:#F8F8F2;"> Id { </span><span style="color:#FF79C6;">get</span><span style="color:#F8F8F2;">; </span><span style="color:#FF79C6;">set</span><span style="color:#F8F8F2;">; }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">    [</span><span style="color:#8BE9FD;font-style:italic;">StringLength</span><span style="color:#F8F8F2;">(</span><span style="color:#BD93F9;">10</span><span style="color:#F8F8F2;">, MinimumLength </span><span style="color:#FF79C6;">=</span><span style="color:#BD93F9;"> 1</span><span style="color:#F8F8F2;">,</span></span>
<span class="line"><span style="color:#F8F8F2;">        ErrorMessage </span><span style="color:#FF79C6;">=</span><span style="color:#E9F284;"> &quot;</span><span style="color:#F1FA8C;">必须 {2} &lt;= {0} Length &lt;= {1}</span><span style="color:#E9F284;">&quot;</span><span style="color:#F8F8F2;">)]</span></span>
<span class="line"><span style="color:#FF79C6;">    public</span><span style="color:#FF79C6;"> string</span><span style="color:#F8F8F2;"> Name { </span><span style="color:#FF79C6;">get</span><span style="color:#F8F8F2;">; </span><span style="color:#FF79C6;">set</span><span style="color:#F8F8F2;">; }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6;">    public</span><span style="color:#FF79C6;"> string</span><span style="color:#F8F8F2;"> Author { </span><span style="color:#FF79C6;">get</span><span style="color:#F8F8F2;">; </span><span style="color:#FF79C6;">set</span><span style="color:#F8F8F2;">; }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"><span style="color:#FF79C6;">public</span><span style="color:#FF79C6;"> void</span><span style="color:#50FA7B;"> ConfigureServices</span><span style="color:#F8F8F2;">(</span><span style="color:#8BE9FD;font-style:italic;">IServiceCollection</span><span style="color:#FFB86C;font-style:italic;"> services</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">{</span></span>
<span class="line"><span style="color:#F8F8F2;">    services.</span><span style="color:#50FA7B;">AddOptions</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#8BE9FD;font-style:italic;">BookOptions</span><span style="color:#F8F8F2;">&gt;()</span></span>
<span class="line"><span style="color:#F8F8F2;">        .</span><span style="color:#50FA7B;">Bind</span><span style="color:#F8F8F2;">(Configuration.</span><span style="color:#50FA7B;">GetSection</span><span style="color:#F8F8F2;">(BookOptions.Book))</span></span>
<span class="line"><span style="color:#F8F8F2;">        .</span><span style="color:#50FA7B;">ValidateDataAnnotations</span><span style="color:#F8F8F2;">();</span></span>
<span class="line"><span style="color:#F8F8F2;">        .</span><span style="color:#50FA7B;">Validate</span><span style="color:#F8F8F2;">(</span><span style="color:#FFB86C;font-style:italic;">options</span><span style="color:#FF79C6;"> =&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">        {</span></span>
<span class="line"><span style="color:#6272A4;">            // 校验通过 return true</span></span>
<span class="line"><span style="color:#6272A4;">            // 校验失败 return false</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span></span>
<span class="line"><span style="color:#FF79C6;">            if</span><span style="color:#F8F8F2;"> (options.Author.</span><span style="color:#50FA7B;">Contains</span><span style="color:#F8F8F2;">(</span><span style="color:#E9F284;">&quot;</span><span style="color:#F1FA8C;">A</span><span style="color:#E9F284;">&quot;</span><span style="color:#F8F8F2;">))</span></span>
<span class="line"><span style="color:#F8F8F2;">            {</span></span>
<span class="line"><span style="color:#FF79C6;">                return</span><span style="color:#BD93F9;"> false</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">            }</span></span>
<span class="line"><span style="color:#F8F8F2;">    </span></span>
<span class="line"><span style="color:#FF79C6;">            return</span><span style="color:#BD93F9;"> true</span><span style="color:#F8F8F2;">;</span></span>
<span class="line"><span style="color:#F8F8F2;">        });</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ivalidateoptions" tabindex="-1"><a class="header-anchor" href="#ivalidateoptions"><span>IValidateOptions</span></a></h3><p>实现<code>IValidateOptions&lt;TOptions&gt;</code>接口，增加数据校验规则</p><div class="language-csharp line-numbers-mode" data-highlighter="shiki" data-ext="csharp" data-title="csharp" style="background-color:#282A36;color:#F8F8F2;"><pre class="shiki dracula vp-code"><code><span class="line"><span style="color:#FF79C6;">public</span><span style="color:#FF79C6;"> class</span><span style="color:#8BE9FD;"> BookValidation</span><span style="color:#F8F8F2;"> : </span><span style="color:#8BE9FD;font-style:italic;">IValidateOptions</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#8BE9FD;font-style:italic;">BookOptions</span><span style="color:#F8F8F2;">&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">{</span></span>
<span class="line"><span style="color:#FF79C6;">    public</span><span style="color:#8BE9FD;font-style:italic;"> ValidateOptionsResult</span><span style="color:#50FA7B;"> Validate</span><span style="color:#F8F8F2;">(</span><span style="color:#FF79C6;">string</span><span style="color:#FFB86C;font-style:italic;"> name</span><span style="color:#F8F8F2;">, </span><span style="color:#8BE9FD;font-style:italic;">BookOptions</span><span style="color:#FFB86C;font-style:italic;"> options</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">    {</span></span>
<span class="line"><span style="color:#FF79C6;">        var</span><span style="color:#F8F8F2;"> failures </span><span style="color:#FF79C6;">=</span><span style="color:#FF79C6;"> new</span><span style="color:#8BE9FD;font-style:italic;"> List</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#FF79C6;">string</span><span style="color:#F8F8F2;">&gt;();</span></span>
<span class="line"><span style="color:#FF79C6;">        if</span><span style="color:#F8F8F2;">(</span><span style="color:#FF79C6;">!</span><span style="color:#F8F8F2;">(options.Id </span><span style="color:#FF79C6;">&gt;=</span><span style="color:#BD93F9;"> 1</span><span style="color:#FF79C6;"> &amp;&amp;</span><span style="color:#F8F8F2;"> options.Id </span><span style="color:#FF79C6;">&lt;=</span><span style="color:#BD93F9;"> 1000</span><span style="color:#F8F8F2;">))</span></span>
<span class="line"><span style="color:#F8F8F2;">        {</span></span>
<span class="line"><span style="color:#F8F8F2;">            failures.</span><span style="color:#50FA7B;">Add</span><span style="color:#F8F8F2;">(</span><span style="color:#E9F284;">$&quot;</span><span style="color:#F1FA8C;">必须 1 &lt;= </span><span style="color:#FF79C6;">{nameof</span><span style="color:#F1FA8C;">(</span><span style="color:#F8F8F2;">options</span><span style="color:#F1FA8C;">.</span><span style="color:#F8F8F2;">Id</span><span style="color:#F1FA8C;">)</span><span style="color:#FF79C6;">}</span><span style="color:#F1FA8C;"> &lt;= </span><span style="color:#FF79C6;">{</span><span style="color:#BD93F9;">1000</span><span style="color:#FF79C6;">}</span><span style="color:#E9F284;">&quot;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">        }</span></span>
<span class="line"><span style="color:#FF79C6;">        if</span><span style="color:#F8F8F2;">(</span><span style="color:#FF79C6;">!</span><span style="color:#F8F8F2;">(options.Name.Length </span><span style="color:#FF79C6;">&gt;=</span><span style="color:#BD93F9;"> 1</span><span style="color:#FF79C6;"> &amp;&amp;</span><span style="color:#F8F8F2;"> options.Name.Length </span><span style="color:#FF79C6;">&lt;=</span><span style="color:#BD93F9;"> 10</span><span style="color:#F8F8F2;">))</span></span>
<span class="line"><span style="color:#F8F8F2;">        {</span></span>
<span class="line"><span style="color:#F8F8F2;">            failures.</span><span style="color:#50FA7B;">Add</span><span style="color:#F8F8F2;">(</span><span style="color:#E9F284;">$&quot;</span><span style="color:#F1FA8C;">必须 1 &lt;= </span><span style="color:#FF79C6;">{nameof</span><span style="color:#F1FA8C;">(</span><span style="color:#F8F8F2;">options</span><span style="color:#F1FA8C;">.</span><span style="color:#F8F8F2;">Name</span><span style="color:#F1FA8C;">)</span><span style="color:#FF79C6;">}</span><span style="color:#F1FA8C;"> &lt;= 10</span><span style="color:#E9F284;">&quot;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6;">        if</span><span style="color:#F8F8F2;"> (failures.</span><span style="color:#50FA7B;">Any</span><span style="color:#F8F8F2;">())</span></span>
<span class="line"><span style="color:#F8F8F2;">        {</span></span>
<span class="line"><span style="color:#FF79C6;">            return</span><span style="color:#F8F8F2;"> ValidateOptionsResult.</span><span style="color:#50FA7B;">Fail</span><span style="color:#F8F8F2;">(failures);</span></span>
<span class="line"><span style="color:#F8F8F2;">        }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6;">        return</span><span style="color:#F8F8F2;"> ValidateOptionsResult.Success;</span></span>
<span class="line"><span style="color:#F8F8F2;">    }</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FF79C6;">public</span><span style="color:#FF79C6;"> void</span><span style="color:#50FA7B;"> ConfigureServices</span><span style="color:#F8F8F2;">(</span><span style="color:#8BE9FD;font-style:italic;">IServiceCollection</span><span style="color:#FFB86C;font-style:italic;"> services</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">{</span></span>
<span class="line"><span style="color:#F8F8F2;">    services.</span><span style="color:#50FA7B;">Configure</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#8BE9FD;font-style:italic;">BookOptions</span><span style="color:#F8F8F2;">&gt;(Configuration.</span><span style="color:#50FA7B;">GetSection</span><span style="color:#F8F8F2;">(BookOptions.Book));</span></span>
<span class="line"><span style="color:#F8F8F2;">    services.</span><span style="color:#50FA7B;">TryAddEnumerable</span><span style="color:#F8F8F2;">(ServiceDescriptor.</span><span style="color:#50FA7B;">Singleton</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#8BE9FD;font-style:italic;">IValidateOptions</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#8BE9FD;font-style:italic;">BookOptions</span><span style="color:#F8F8F2;">&gt;, </span><span style="color:#8BE9FD;font-style:italic;">BookValidation</span><span style="color:#F8F8F2;">&gt;());</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="options-后期配置" tabindex="-1"><a class="header-anchor" href="#options-后期配置"><span>Options 后期配置</span></a></h2><p>✅ <code>PostConfigure&lt;T&gt;()</code>：对特定命名配置实例或默认实例，在配置绑定之后做“后处理”</p><p>✅ <code>PostConfigureAll&lt;T&gt;()</code>：对所有命名实例都执行相同的“后处理”</p><div class="language-csharp line-numbers-mode" data-highlighter="shiki" data-ext="csharp" data-title="csharp" style="background-color:#282A36;color:#F8F8F2;"><pre class="shiki dracula vp-code"><code><span class="line"><span style="color:#FF79C6;">public</span><span style="color:#FF79C6;"> void</span><span style="color:#50FA7B;"> ConfigureServices</span><span style="color:#F8F8F2;">(</span><span style="color:#8BE9FD;font-style:italic;">IServiceCollection</span><span style="color:#FFB86C;font-style:italic;"> services</span><span style="color:#F8F8F2;">)</span></span>
<span class="line"><span style="color:#F8F8F2;">{</span></span>
<span class="line"><span style="color:#F8F8F2;">    services.</span><span style="color:#50FA7B;">PostConfigure</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#8BE9FD;font-style:italic;">DateTimeOptions</span><span style="color:#F8F8F2;">&gt;(</span><span style="color:#FFB86C;font-style:italic;">options</span><span style="color:#FF79C6;"> =&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">    {</span></span>
<span class="line"><span style="color:#F8F8F2;">        Console.</span><span style="color:#50FA7B;">WriteLine</span><span style="color:#F8F8F2;">(</span><span style="color:#E9F284;">$&quot;</span><span style="color:#F1FA8C;">我只对名称为</span><span style="color:#FF79C6;">{</span><span style="color:#F8F8F2;">Options</span><span style="color:#F1FA8C;">.</span><span style="color:#F8F8F2;">DefaultName</span><span style="color:#FF79C6;">}</span><span style="color:#F1FA8C;">的</span><span style="color:#FF79C6;">{nameof</span><span style="color:#F1FA8C;">(</span><span style="color:#F8F8F2;">DateTimeOptions</span><span style="color:#F1FA8C;">)</span><span style="color:#FF79C6;">}</span><span style="color:#F1FA8C;">实例进行后期配置</span><span style="color:#E9F284;">&quot;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">    services.</span><span style="color:#50FA7B;">PostConfigure</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#8BE9FD;font-style:italic;">DateTimeOptions</span><span style="color:#F8F8F2;">&gt;(DateTimeOptions.Beijing, </span><span style="color:#FFB86C;font-style:italic;">options</span><span style="color:#FF79C6;"> =&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">    {</span></span>
<span class="line"><span style="color:#F8F8F2;">        Console.</span><span style="color:#50FA7B;">WriteLine</span><span style="color:#F8F8F2;">(</span><span style="color:#E9F284;">$&quot;</span><span style="color:#F1FA8C;">我只对名称为</span><span style="color:#FF79C6;">{</span><span style="color:#F8F8F2;">DateTimeOptions</span><span style="color:#F1FA8C;">.</span><span style="color:#F8F8F2;">Beijing</span><span style="color:#FF79C6;">}</span><span style="color:#F1FA8C;">的</span><span style="color:#FF79C6;">{nameof</span><span style="color:#F1FA8C;">(</span><span style="color:#F8F8F2;">DateTimeOptions</span><span style="color:#F1FA8C;">)</span><span style="color:#FF79C6;">}</span><span style="color:#F1FA8C;">实例进行后期配置</span><span style="color:#E9F284;">&quot;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">    });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F8F8F2;">    services.</span><span style="color:#50FA7B;">PostConfigureAll</span><span style="color:#F8F8F2;">&lt;</span><span style="color:#8BE9FD;font-style:italic;">DateTimeOptions</span><span style="color:#F8F8F2;">&gt;(</span><span style="color:#FFB86C;font-style:italic;">options</span><span style="color:#FF79C6;"> =&gt;</span></span>
<span class="line"><span style="color:#F8F8F2;">    {</span></span>
<span class="line"><span style="color:#F8F8F2;">        Console.</span><span style="color:#50FA7B;">WriteLine</span><span style="color:#F8F8F2;">(</span><span style="color:#E9F284;">$&quot;</span><span style="color:#F1FA8C;">我对</span><span style="color:#FF79C6;">{nameof</span><span style="color:#F1FA8C;">(</span><span style="color:#F8F8F2;">DateTimeOptions</span><span style="color:#F1FA8C;">)</span><span style="color:#FF79C6;">}</span><span style="color:#F1FA8C;">的所有实例进行后期配置</span><span style="color:#E9F284;">&quot;</span><span style="color:#F8F8F2;">);</span></span>
<span class="line"><span style="color:#F8F8F2;">    });</span></span>
<span class="line"><span style="color:#F8F8F2;">}</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="参考" tabindex="-1"><a class="header-anchor" href="#参考"><span>参考</span></a></h2><ul><li><a href="https://gitee.com/soul-au/aspnetcore/blob/master/docs/04-Options.md" target="_blank" rel="noopener noreferrer">AspNetCore企业级开发</a></li><li><a href="https://www.cnblogs.com/xiaoxiaotank/p/15391905.html" target="_blank" rel="noopener noreferrer">理解ASP.NET Core - 选项(Options)</a></li></ul>`,41)]))}const i=n(p,[["render",e],["__file","options.html.vue"]]),c=JSON.parse('{"path":"/dotnet/options.html","title":"选项 Options","lang":"en-US","frontmatter":{"title":"选项 Options","date":"2025-04-18T00:00:00.000Z","category":["DotNet"],"description":"在 .NET 中，Options 是一套 用于绑定和管理配置的推荐做法，比直接使用 IConfiguration 更加强类型、安全、可维护。 把配置项绑定到强类型对象（类似 Get<AppSettings>()） 支持依赖注入（通过 IOptions<T>注入配置） 支持配置验证、热更新（reload on change）等高级功能 让配置逻辑和业务逻...","head":[["meta",{"property":"og:url","content":"https://luxiag.github.io/luxiag/blog/dotnet/options.html"}],["meta",{"property":"og:title","content":"选项 Options"}],["meta",{"property":"og:description","content":"在 .NET 中，Options 是一套 用于绑定和管理配置的推荐做法，比直接使用 IConfiguration 更加强类型、安全、可维护。 把配置项绑定到强类型对象（类似 Get<AppSettings>()） 支持依赖注入（通过 IOptions<T>注入配置） 支持配置验证、热更新（reload on change）等高级功能 让配置逻辑和业务逻..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"en-US"}],["meta",{"property":"og:updated_time","content":"2025-04-23T08:18:43.000Z"}],["meta",{"property":"article:published_time","content":"2025-04-18T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2025-04-23T08:18:43.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"选项 Options\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2025-04-18T00:00:00.000Z\\",\\"dateModified\\":\\"2025-04-23T08:18:43.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"luxiag\\",\\"url\\":\\"https://luxiag.github.io/luxiag\\"}]}"]]},"git":{"createdTime":1745396323000,"updatedTime":1745396323000,"contributors":[{"name":"luxiag","username":"luxiag","email":"luxiag@qq.com","commits":1,"url":"https://github.com/luxiag"}]},"readingTime":{"minutes":4.56,"words":1368},"filePathRelative":"dotnet/options.md","localizedDate":"April 18, 2025","excerpt":"<p>在 .NET 中，Options 是一套 用于绑定和管理配置的推荐做法，比直接使用 IConfiguration 更加强类型、安全、可维护。</p>\\n<ul>\\n<li>\\n<p>把配置项绑定到强类型对象（类似 <code>Get&lt;AppSettings&gt;()</code>）</p>\\n</li>\\n<li>\\n<p>支持依赖注入（通过 <code>IOptions&lt;T&gt;</code>注入配置）</p>\\n</li>\\n<li>\\n<p>支持配置验证、热更新（reload on change）等高级功能</p>\\n</li>\\n<li>\\n<p>让配置逻辑和业务逻辑分离，提高代码可读性和可测试性</p>\\n</li>\\n</ul>","autoDesc":true}');export{i as comp,c as data};
